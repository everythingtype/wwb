jQuery(document).ready(function(t){function e(e){this.step=e,this.pt=null,this.linked_pt_count=0,this.linked_pt_cur=0,this.total_posts=0,this.ppr=null,this.action=null,this.percentage_object=null,this.nonce=null,this.do_request=function(){var e=this;t.post(ajaxurl,{action:this.action,nonce:t("#rp4wp-ajax-nonce").val(),ppr:this.ppr,pt:this.pt,linked_pt_cur:this.linked_pt_cur},function(t){var n=new RegExp("^[0-9]+$");if(t=t.trim(),n.test(t)){var r=parseInt(t);e.do_progressbar(r),r>0?e.do_request():e.done()}else alert("Woops! Something went wrong while linking.\n\nResponse:\n\n"+t)})},this.done=function(){t("#progressbar").progressbar({value:100});var e=t("#rp4wp_admin_url").val()+"?page=rp4wp_install&pt="+this.pt+"&rp4wp_nonce="+this.nonce;2===this.step&&this.linked_pt_cur<this.linked_pt_count?e+="&step="+this.step+"&cur="+(this.linked_pt_cur+1):e+="&step="+(this.step+1),window.location=e},this.do_progressbar=function(e){var n=this.total_posts-e;n<0&&(n=0),jQuery("#progress-done").html(n),jQuery("#progress-todo").html(e);var r=Math.round(n/this.total_posts*100);r>0&&(this.percentage_object.html(r+"%"),t("#progressbar").progressbar({value:r}))},this.init=function(){switch(this.pt=t("#rp4wp_post_type").val(),this.linked_pt_count=parseInt(t("#linked_pt_count").val()),this.linked_pt_cur=parseInt(t("#linked_pt_cur").val()),this.nonce=t("#rp4wp_nonce").val(),t("#progressbar").progressbar({value:!1}),this.percentage_object=jQuery("<span>"),t("#progressbar").find("div:first").append(this.percentage_object),this.do_progressbar(0),this.total_posts=t("#rp4wp_total_posts").val(),this.step){case 2:this.ppr=25,this.action="rp4wp_install_save_words";break;case 3:this.ppr=5,this.action="rp4wp_install_link_posts"}if(jQuery("#progress-container").show(),3==this.step){var e=this;t.post(ajaxurl,{action:"rp4wp_install_save_options",nonce:t("#rp4wp-ajax-nonce").val(),pt:this.pt,rel_amount:t("#rp4wp_related_posts_amount").val(),rp4wp_related_posts_age:t("#rp4wp_related_posts_age").val()},function(t){"success"==(t=t.trim())?e.do_request():alert("Woops! Something went wrong while linking.\n\nResponse:\n\n"+t)})}else this.do_request()},this.init()}t.fn.rp4wp_install_pt_table=function(){this.editing=!1,this.available_post_type=t("#rp4wp-availabe_post_types").val().split(","),this.get_row_by_pt=function(e){var n=t(this).find("tr[rel="+e+"]");return n||null},this.get_linked_post_types=function(e){var n=new Array;return t.each(e.find("td.rp4wp-children ul li"),function(e,r){t(r).attr("id")&&n.push(t(r).attr("id"))}),n},this.get_available_post_types=function(t){for(var e=this.available_post_type.slice(),n=this.get_linked_post_types(this.get_row_by_pt(t)),r=new Array,p=0;p<e.length;p++)-1==n.indexOf(e[p])&&r.push(e[p]);return r},this.disable_buttons=function(){t(this).find(".button").addClass("disabled")},this.enable_buttons=function(){t(this).find(".button").removeClass("disabled")},this.add_new_pt_button=function(e){var n=this,r=this.get_available_post_types(e.attr("rel"));0==e.find(".add-pt").length&&r.length>0&&e.find("td.rp4wp-children ul").append(t("<li>").addClass("add-pt").append(t("<span>").html("Add New Post Type")).click(function(){for(var p=t("<select>"),i=0;i<r.length;i++)p.append(t("<option>").val(r[i]).html(rp4wp_js[r[i]]));t(this).parent().append(t("<li>").addClass("new-pt").append(p).append(t("<a>").attr("href","javascript:;").addClass("add-pt-plus rp4wp-has-tip").attr("title",rp4wp_js.lbl_add_pt).html("+").click(function(){n.add_post_type(e,t(this).parent().find("select option:selected").val())}))),t(this).remove(),Tipped.create(".rp4wp-has-tip",{position:"top"})}))},this.add_post_type=function(e,n){var r=this;e.find(".new-pt").remove(),e.find("td.rp4wp-children ul").append(t("<li>").attr("id",n).addClass("edit").append(t("<span>").html(rp4wp_js[n])).append(t("<a>").addClass("remove-btn").click(function(){t(this).parent().remove(),r.add_new_pt_button(e)}))),this.add_new_pt_button(e)},this.edit_row=function(e){var n=this;this.editing=!0,this.disable_buttons();var r=this.get_row_by_pt(e);r?(r.removeClass("inactive"),t.each(r.find("td.rp4wp-children ul li"),function(e,p){t(p).addClass("edit").append(t("<a>").addClass("remove-btn").click(function(){t(this).parent().remove(),n.add_new_pt_button(r)}))}),this.add_new_pt_button(r),r.find(".rp4wp-button .rp4wp-buttons-wrap").hide(),r.find(".rp4wp-button").append(t("<a>").addClass("button button-primary").addClass("rp4wp-btn-save rp4wp-has-tip").attr("href","javascript:;").attr("rel","save").attr("title",rp4wp_js.lbl_save).click(function(){n.save_row(e)})),Tipped.create(".rp4wp-has-tip",{position:"top"})):this.editing=!1},this.restore_row=function(e){var n=this.get_row_by_pt(e);n.find(".add-pt").remove(),n.find(".new-pt").remove(),t.each(n.find("td.rp4wp-children ul li"),function(e,n){t(n).removeClass("edit").find("a").remove()}),n.find("a[rel=save]").remove(),n.find(".rp4wp-button .rp4wp-buttons-wrap").show(),0===n.find("td.rp4wp-children ul li").length&&(n.addClass("inactive"),n.find(".rp4wp-buttons-wrap a.button[rel=delete]").remove())},this.save_row=function(e){this.restore_row(e),this.editing=!1,this.enable_buttons(),t.post(ajaxurl,{action:"rp4wp_install_set_post_types",parent:e,nonce:t("#rp4wp-ajax-nonce").val(),post_types:this.get_linked_post_types(this.get_row_by_pt(e))},function(n){"success"===n.result?!0===n.redirect&&(window.location=t("#rp4wp_admin_url").val()+"?page=rp4wp_install&pt="+e+"&step=2&rp4wp_nonce="+t("#rp4wp_nonce").val()):alert("Whoops! Something went wrong:\n\n"+n.error)})},this.generate_remove_button=function(){var e=this;return t("<a>").addClass("button").addClass("button-primary").addClass("rp4wp-btn-delete rp4wp-has-tip").attr("rel","delete").attr("href","javascript:;").attr("title",rp4wp_js.lbl_delete).click(function(){if(!1===e.editing){var n=t(this).closest("tr").attr("rel");e.edit_row(n);var r=e.get_row_by_pt(n);t.each(r.find("td.rp4wp-children ul li"),function(t,e){e.remove()}),e.save_row(n)}})},this.generate_relink_button=function(){var e=this;return t("<a>").addClass("button").addClass("button-primary").addClass("rp4wp-btn-relink rp4wp-has-tip").attr("rel","rerun").attr("title",rp4wp_js.lbl_relink).attr("href","javascript:;").click(function(){if(!1===e.editing){var n=t(this).closest("tr").attr("rel");t.post(ajaxurl,{action:"rp4wp_install_relink",parent:n,nonce:t("#rp4wp-ajax-nonce").val()},function(e){"success"===e.result?!0===e.redirect&&(window.location=t("#rp4wp_admin_url").val()+"?page=rp4wp_install&pt="+n+"&step=3&rp4wp_nonce="+t("#rp4wp_nonce").val()):alert("Whoops! Something went wrong:\n\n"+e.error)})}})},this.generate_reinstall_button=function(){var e=this;return t("<a>").addClass("button").addClass("button-primary").addClass("rp4wp-btn-reinstall rp4wp-has-tip").attr("rel","rerun").attr("title",rp4wp_js.lbl_reinstall).attr("href","javascript:;").click(function(){if(!1===e.editing){var n=t(this).closest("tr").attr("rel");t.post(ajaxurl,{action:"rp4wp_install_reinstall",parent:n,nonce:t("#rp4wp-ajax-nonce").val()},function(e){"success"===e.result?!0===e.redirect&&(window.location=t("#rp4wp_admin_url").val()+"?page=rp4wp_install&pt="+n+"&step=2&rp4wp_nonce="+t("#rp4wp_nonce").val()):alert("Whoops! Something went wrong:\n\n"+e.error)})}})},this.init=function(){var e=this;t.each(t(this).find("tr"),function(n,r){if(null!=t(r).attr("rel")){var p=t(r).attr("rel");t(r).find("a.button[rel=edit]").click(function(){!1===e.editing&&e.edit_row(p)}),e.get_linked_post_types(t(r)).length>0&&(t(r).find(".rp4wp-buttons-wrap").append(e.generate_relink_button()),t(r).find(".rp4wp-buttons-wrap").append(e.generate_reinstall_button()),t(r).find(".rp4wp-buttons-wrap").append(e.generate_remove_button()))}}),Tipped.create(".rp4wp-has-tip",{position:"top"})},this.init()};var n=t(".rp4wp-step").attr("rel");1==n?t(".rp4wp-table-pt-overview").rp4wp_install_pt_table():2==n?e(2):3==n&&t("#rp4wp-link-now").click(function(){e(3)})});